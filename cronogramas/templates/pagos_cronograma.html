{% extends 'base.html' %}

{% block title %}Pagos del Cronograma - {{ detalle_cronograma }}{% endblock %}

{% block content %}
<div class="container">
    <h2>Pagos del Cronograma - {{ detalle_cronograma }}</h2>
    <table id="pagos-table" class="table table-striped">
        <thead>
            <tr>
                <th>Fecha de Pago</th>
                <th>Monto de Pago</th>
                <th>Documento de Pago</th>
            </tr>
        </thead>
        <tbody>
            {% for pago in pagos %}
            <tr>
                <td>
                    <!-- Muestra la fecha actual del pago -->
                    <span id="fecha_pago_{{ pago.id }}">
                        {{ pago.fecha_pago|date:"Y-m-d" }}
                    </span>
                    <!-- Enlace para mostrar el formulario de edición de fecha -->
                    <a href="#" onclick="document.getElementById('edit-fecha-form-{{ pago.id }}').style.display='block'; return false;">Editar Fecha</a>
                    <!-- Formulario para editar la fecha de pago -->
                    <form id="edit-fecha-form-{{ pago.id }}" style="display:none;" method="post" hx-post="{% url 'editar_fecha_pago' pago.id %}" hx-target="#fecha_pago_{{ pago.id }}" hx-swap="outerHTML">
                        {% csrf_token %}
                        <input type="date" name="fecha_pago" value="{{ pago.fecha_pago|date:'Y-m-d' }}">
                        <button type="submit">Guardar</button>
                    </form>
                </td>
                <td>
                    <span id="monto_pago_{{ pago.id }}">
                        {{ pago.monto_pago }}
                    </span>
                    <!-- Enlace para mostrar el formulario de edición de monto -->
                    <a href="#" onclick="document.getElementById('edit-monto-form-{{ pago.id }}').style.display='block'; return false;">Editar Monto</a>
                    <!-- Formulario para editar el monto de pago -->
                    <form id="edit-monto-form-{{ pago.id }}" style="display:none;" hx-post="{% url 'editar_monto_pago' pago.id %}" hx-target="#monto_pago_{{ pago.id }}" hx-swap="outerHTML">
                        {% csrf_token %}
                        <input type="text" name="monto_pago" value="{{ pago.monto_pago }}">
                        <button type="submit">Guardar</button>
                    </form>
                </td>
                <td>
                    {% if pago.pdf_pago %}
                        <a href="{{ pago.pdf_pago.url }}" target="_blank">Ver Documento de Pago</a>
                    {% else %}
                        No hay documento adjunto
                    {% endif %}
                    <!-- Formulario para cambiar PDF -->
                    <form style="display:inline;" hx-post="{% url 'cambiar_pdf_pago' pago.id %}" enctype="multipart/form-data" hx-target="#pdf_pago_{{ pago.id }}" hx-swap="outerHTML">
                        {% csrf_token %}
                        <input type="file" name="pdf_pago">
                        <button type="submit">Cambiar PDF</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
